\RequirePackage{pdfmanagement-testphase}
\DeclareDocumentMetadata{uncompress}
\documentclass{article}
\usepackage{array}
\directlua{require'parse_icc_tex'}
\begin{document}
\ExplSyntaxOn
\group_begin:
\cs_set:Npn \__my_tmp:n #1
  {
    \cs_set_protected:Npn \__color_convert:nnnN ##1##2##3##4
      {
        \bool_if:nTF
          {
            \cs_if_exist_p:c { l__color_ ##1 _profile }
            &&
            \cs_if_exist_p:c { l__color_ ##2 _profile }
          }
          {
            \tl_set:Nx ##4
              {
                \ApplyProfile \use:c { l__color_ ##2 _profile } 1 \use:c { l__color_ ##1 _profile } ##3
              }
          }
          {
            #1
          }
      }
  }
\exp_last_unbraced:Nf \group_end: { \exp_args:No \__my_tmp:n { \__color_convert:nnnN {#1}{#2}{#3}{#4} } }
\group_begin:
\cs_set:Npn \__my_tmp:n #1
  {
    \cs_set_protected:Npn \color_profile_apply:nn ##1##2
      {
        #1
        \exp_args:Nc \LoadProfile { l__color_ ##2 _profile } {##1}
      }
  }
\exp_last_unbraced:Nf \group_end: { \exp_args:No \__my_tmp:n { \color_profile_apply:nn {#1}{#2} } }
\group_begin:
\cs_set:Npn \__my_tmp:n #1
  {
    \cs_set_protected:Npn \__color_model_iccbased:nn ##1##2
      {
        #1
        \exp_args:Nc \LoadProfile { l__color_ ##2 _profile } {##1}
      }
  }
\exp_last_unbraced:Nf \group_end: { \exp_args:No \__my_tmp:n { \__color_model_iccbased:nn {#1}{#2} } }

\color_profile_apply:nn {FOGRA39L_coated.icc} {cmyk}
\color_model_new:nnn{srgb}{ICCBased}{file=sRGB.icc}
\color_model_new:nnn{sgrb}{ICCBased}{file=SwappedRedAndGreen.icc}
\cs_generate_variant:Nn \color_select:nn { nf }
\cs_new_eq:NN \colorselect \color_select:nf
\cs_new_protected:Npn \selectmodel { \tl_set:Nn \l_color_fixed_model_tl }
\cs_new:Npn \iterate { \int_step_inline:nnn {0} {1000} }
\ExplSyntaxOff
Test:
  \selectmodel {rgb}%
  \colorselect{cmyk}{0.9,0.1,0.1,0}%
  \vrule width 5em
  \selectmodel {srgb}%
  \colorselect{cmyk}{0.9,0.1,0.1,0}%
  \vrule width 5em
  \selectmodel {sgrb}%
  \colorselect{cmyk}{0.9,0.1,0.1,0}%
  \vrule width 5em
  \selectmodel {cmyk}%
  \colorselect{cmyk}{0.9,0.1,0.1,0}%
  \vrule width 5em
\end{document}
